{% load static %}

<!DOCTYPE html>
	<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Transcendence</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="{% static 'css/login.css' %}">
    <link rel="stylesheet" href="{% static 'css/chat.css' %}">
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}">
    <link rel="stylesheet" href="{% static 'css/multiplayer.css' %}">
  </head>
  <body>

	{% include "navbar.html" %}

	<div id="alerts-container"></div>

    <main id="oldContent">
		{% block content %}{% endblock content %}
    </main>

	<div id="chat">

		{% include "chatroom.html" %}

	</div>

	<script type="module">
    import {searchFriends} from '{% static "js/friends/action_friends.js" %}';

    window.addEventListener('popstate', function(event) {
			if (event.state && event.state.path) {
				updateContent(event.state.path);
			}
		});

    document.addEventListener("DOMContentLoaded", function() {
      reattachEventListeners();
    });

		function updateContent(path) {
			//check if path is default path because of navigation in Browser. If default then oldContent is empty!
			fetch(path)
			.then(response => {
				if (!response.ok) {
				  if (response.status === 401) {
					updateContent("/login/");
				  } else if (response.status === 403) {
					updateContent("/login/");
				  } else {
					throw new Error("Unexpected Error");
				  }
				}
				return response.text();
			})
			.then(html => {
			const parser = new DOMParser();
			const doc = parser.parseFromString(html, "text/html");
			const newContent = doc.querySelector("#newContent");
			const oldContent = document.getElementById("oldContent");
			oldContent.innerHTML = "";
			oldContent.appendChild(newContent);
			reattachEventListeners();
			 })
			 .catch(error => console.error('Error fetching content:', error));
		};

		function handleRoute(event, path) {
			event.preventDefault();
			if (window.location.pathname !== path) {
				window.history.pushState({path: path}, '', path);
				updateContent(path);
			}
		}

		export function reattachEventListeners(){
			loginButton()
			login()
			logout()
			generateQRCode()
			validateOTP()
			oauth()
			homeButton()
			defaultButton()
			bindProfileButton()
			soloGame()
			multiplayerGame()
			handleCheckbox()
			checkBox()
			setNewPasswd()
      searchFriends()
		}
  </script>

  {% comment %} MODULE {% endcomment %}
  <script type="module" src="{% static "js/module.js" %}"></script>

  {% comment %}
    @Functions:
      - activatetwoFA()
      - deactivatetwoFA()
      - checkBox()
      - handleCheckbox()
      - setNewPasswd()
      - getUsernameFromBackend()
      - checkAccessToken()
  {% endcomment %}
  <script src="{% static "js/profile/2FA.js" %}"></script>
  <script src="{% static "js/profile/profile.js" %}"></script>
  <script src="{% static "js/profile/buttons.js" %}"></script>
  <script src="{% static "js/profile/fetch.js" %}"></script>

  {% comment %}
    @Navbar
    @Functions:
      - showLoggedInState()
      - showLoggedOutState()
      - soloGame()
      - multiplayerGame()
      - loginButton()
      - defaultButton()
      - homeButton()
      - set_passwd()
      - oauth()
      - login()
      - logout()
  {% endcomment %}
  <script src="{% static "js/navbar/navbar.js" %}"></script>
  <script src="{% static "js/navbar/buttons.js" %}"></script>
  <script src="{% static "js/navbar/logging.js" %}"></script>

  {% comment %}
    @Functions:
  {% endcomment %}
  <script src="{% static "js/register/fetch.js" %}"></script>

  {% comment %}
    @Functions:
      - reset()
      - start_game()
      - window.onload
  {% endcomment %}
  <script src="{% static "js/game/game.js" %}"></script>

  {% comment %}
    @Functions:
      - acceptRequest()
      - denyRequest()
      - checkFriendRequest()
      - sendFriendRequest()
      - deleteFriend()
      - pendingFriendRequest()
      - updateUserStatus()
  {% endcomment %}
  <script src="{% static "js/friends/fetch.js" %}"></script>
  <script type="module" src="{% static "js/friends/action_friends.js" %}"></script>

  {% comment %}
    @Functions:
        - blockUser()
        - unblockUser()
  {% endcomment %}
  <script src="{% static "js/chat/fetch.js" %}"></script>
  <script src="{% static "js/chat/action_chat.js" %}"></script>


  {% comment %} 1 {% endcomment %}
  <script src="{% static "js/security/csrft.js" %}"></script>
  <script src="{% static "js/security/jwt.js" %}"></script>

  {% comment %}  {% endcomment %}
  <script src="{% static "js/login_check.js" %}"></script>

	</body>
	</html>


